<!-- templates/main.html -->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Main Page</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="{{ url_for('static', filename='js/puzzle.js') }}"></script>
    <style>
        .custom-green {
            background-color: #03D182;
        }
    </style>
</head>

<body class="bg-black text-white">

    {% include 'header.html' %}

    <div class="w-full mx-auto py-8">
        <h1 id="day-display" class="text-center text-3xl mb-6">DAY</h1>
        <div class="flex flex-col justify-center items-center pb-20  border-gray-500" style="border-bottom-width: 1px;">
            <div id="tile-container" class="grid grid-cols-7 gap-1 rounded-lg"
                style="width: 100%; height: 100%; background-image: url('../static/images/PuzzleImage1.png'); background-repeat: no-repeat; background-size: cover; ">

                <!-- JavaScript를 사용하여 35개의 타일을 동적으로 생성합니다. -->
                <script>
                    // 전역 변수로 선언하여 화면 너비의 50% 값을 저장
                    var screenWidth80Percent = window.innerWidth * 0.5;

                    // 숨기고자 하는 타일 ID를 지정하는 배열
                    var list = [1, 3, 6, 20, 21, 34];

                    // 타일 컨테이너 가져오기
                    const tileContainer = document.getElementById('tile-container');

                    // 타일 컨테이너의 너비 설정
                    tileContainer.style.width = screenWidth80Percent + 'px';

                    // 임시 이미지 객체를 만들어 원본 크기를 가져옴
                    const tempImage = new Image();
                    tempImage.src = '../static/images/PuzzleImage1.png';

                    tempImage.onload = function () {
                        // 이미지 로드가 완료된 후에 해상도를 사용하여 높이를 계산
                        const imageWidth = this.naturalWidth;
                        const imageHeight = this.naturalHeight;
                        const imageAspectRatio = imageHeight / imageWidth; // 이미지의 가로:세로 비율 계산

                        // 이미지 비율에 맞게 높이 설정
                        const containerHeight = screenWidth80Percent * imageAspectRatio;
                        tileContainer.style.height = containerHeight + 'px';

                        // 35개의 타일 생성
                        for (let i = 1; i <= 35; i++) {  // 타일 ID는 1부터 35까지
                            const tile = document.createElement('div');
                            tile.style = 'position: relative; width: 100%; height: 100%;';
                            tile.id = 'tile-' + i;  // 각 타일에 고유 ID 부여 (예: tile-1, tile-2, ...)

                            // list에 있는 ID를 가진 타일은 투명한 타일로 설정
                            if (list.includes(i)) {
                                tile.className = 'tile transparent-tile rounded-lg';
                            } else {
                                tile.className = 'tile bg-green-500 rounded-lg';
                            }
                            tileContainer.appendChild(tile);
                        }
                    };

                    // 현재 날짜를 기준으로 DAY를 계산하는 함수
                    function calculateDay() {
                        const now = new Date();
                        const startDay = new Date('2024-09-01T06:00:00'); // 기준 시작 날짜와 시간 (9/1 06:00am)
                        const oneDay = 24 * 60 * 60 * 1000; // 하루를 밀리초로 변환

                        // 현재 시간이 6시 이전이면 어제 날짜를 기준으로 계산
                        if (now.getHours() < 6) {
                            now.setDate(now.getDate() - 1);
                        }

                        const diffDays = Math.floor((now - startDay) / oneDay); // 시작일로부터 경과한 일 수 계산
                        const dayNumber = Math.floor(diffDays / 1); // 일(day) 기준으로 DAY 계산

                        // 표시할 기간을 설정 (예: 9/3~9/4)
                        const periodStart = new Date(startDay.getTime() + dayNumber * oneDay);
                        const periodEnd = new Date(periodStart.getTime() + oneDay);
                        const periodText = `${formatDate(periodStart)} ~ ${formatDate(periodEnd)}`;

                        return `DAY${dayNumber} (${periodText})`;
                    }

                    // 날짜 형식을 'MM/DD'로 변환하는 함수
                    function formatDate(date) {
                        const month = (date.getMonth() + 1).toString().padStart(2, '0');
                        const day = date.getDate().toString().padStart(2, '0');
                        return `${month}/${day}`;
                    }

                    // 페이지 로드 시 DAY 계산 및 업데이트
                    window.onload = function () {
                        document.getElementById('day-display').innerText = calculateDay();
                    };
                </script>
            </div>
        </div>

        <!-- 기여한 사람들 섹션 -->
        <div class="mt-8 text-center">
            <h2 class="text-2xl mb-4">기여한 사람</h2>
            <div class="grid grid-cols-5 gap-4 text-green-500">
                <!-- 기여자 이름 리스트 -->
                <span>Test account1</span>
                <span>Test account2</span>
                <span>Test account3</span>
                <!-- 기여자 이름 더 추가... -->
            </div>
        </div>
    </div>

    {% include 'footer.html' %}

</body>

</html>